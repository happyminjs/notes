* **重构原因** 
```
1、代码是SVN，基本都已业务线命名，目录混乱，很少已项目维度区分，查找相应页面的代码困难
2、之前使用的是 grunt，配置太过复杂，其他人临时接手成本太高，如环境配置node版本要求等 
3、58和安居客相似功能太多，之前都是单独分开的，每次变更都需要多个项目同时更改相同的代码
4、使用的还是ES5，没有引入babel编译
```
* **目标**
```
1、上手快速简单方便
2、实现完整的前后分离
3、58和安居客合并，放一起，做代码抽离，两端融合
3、代码规范，命名规范 ts + tslint
```
* **改为使用 webpack + ES6 + jQuery + ts； node + express + axios + nunjucks**
```
node 获取首屏数据，渲染模板页面，保证 seo 效果。
js打包： 根据平台区分命令，传入 target 参数，打包页面代码
```
* **选择技术栈原因** 
```
1、选择 webpack： 配置方便，模块观念，没有什么运行环境差异，上手快
2、继续nunjucks模板渲染：原因，为什么没有选择 SSR
  人员比较紧张，而且业务迭代比较快，时间比较紧张，
  所以选择了技术向业务倾倒的决定，继续模板渲染
3、选择 jQuery：由于选择了nunjucks模板渲染，加上一些集团公用插件基于jQuery的，
  所以选择了jQuery框架。
```
* **成果** 
```
1、新介入人员可以不用繁琐配置，且项目结构清晰合理，快速上手
2、项目管理统一，维护方便很多； 58和安居客两端一起，功能融合会特别方便
3、提取公用插件和模块进行封装，方便后期使用维护
4、ts 强类型校验，方便后期读代码了解业务
```
* **重构中碰到最大的问题**： 
```
1、对于58和安居客怎么融合，公用代码抽离怎么规划，项目规划是重点难点   
  a、纯业务相同的抽离
    比如页面内一些列表，异步渲染模块部分等，还有基本相同的页面
  b、与业务无关的方法的抽离
    比如：请求方法，对接口异常情况的统一处理；axios的配置拦截器；
    本地存储方法的完善，比如localStorage存储满了后会报错的处理，添加存储时间配置等；
    埋点方法等等 
2、读历史代码困难，有很多不规范的代码，尤其是命名，好多单字母的变量，
所以 ts 的优势就特别明显了~~~
```

* **项目结构**

node部分结构
```bash
|- bin
|   |- restart.sh
|   |- start.sh 在linux服务器上启动node服务
|   |- stop.sh
|- config # 本地开发config，存放一些环境ip，或者环境变量等参数
|- config-online # 线上环境config
|- config-sandbox # 沙箱环境
|- build 本地打包目录，本地运行调试时需本地打包
|- src
|   |- controller
|   |- router # 其他目录下都是按平台业务线做了目录划分
|       |- zf.m.ts
|       |- zf.pc.ts
|   |- service
|   |- utils # 共用方法，如获取环境信息，用户信息，axios配置，等公用api
|   |- views # 同前端js一样，按端拆分
|   |- serve.ts # 入口文件
|- package.json
|- tsconfig.json
|- .npmrc 指定服务器上打包时的npm源
```
前端js打包结构
```bash
|- build  # 打包结果目录
|- webpack-config # webpack配置文件目录
|- src
|   |- utils  # 通用 api，如 cookie，storage，axios配置，urlParams等
|   |- plugin # 第三方插件js，非npm包形式的
|   |- pc
|       |- assets
|           |- images # pc通用图片
|           |- less  # pc通用样式
|       |- common # 登录、退出、隐私通话、微聊 等等
|       |- components
|           |- 58  # 58独有的组件
|           |- ajk  # ajk独有的组件
|           |- public  # 58和安居客共用的组件
|       |- pages_58 # 一般是老的页面，UI未调整修改的58页面
|       |- pages_ajk  # 一般是老的页面，UI未调整修改的安居客页面
|       |- pages_public # 58和安居客UI类似的页面，比如经纪人，小区等页面
|   |- m 
|       |- assets 
|           |- images # m通用图片
|           |- less  # m通用样式
|       |- common # 登录、退出、隐私通话、微聊 等等
|       |- components
|           |- 58  # 58独有的组件
|           |- ajk  # ajk独有的组件
|           |- public  # 58和安居客共用的组件
|       |- pages_58
|       |- pages_ajk
|       |- pages_public
```
* **ts优势**
如果说是近期一个人维护的代码优势和他的成本相比不是很明显
但是如果是时间长了，多人维护的时候优势就会非常明显了，能一眼明确方法使用和参数要求
